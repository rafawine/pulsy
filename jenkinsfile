pipeline {
    agent any

    tools {
        go '1.23.6'
    }

    
    stages {
        stage("build_app") {
            steps {
                environment {
                    GIN_MODE = 'release'
                }
                withCredentials([string(credentialsId: 'port', variable: 'PORT'), 
                                string(credentialsId: 'type', variable: 'TYPE'),
                                string(credentialsId: 'project_id', variable: 'PROJECT_ID'),
                                string(credentialsId: 'private_key_id', variable: 'PRIVATE_KEY_ID'),
                                string(credentialsId: 'private_key', variable: 'PRIVATE_KEY'),
                                string(credentialsId: 'client_email', variable: 'CLIENT_EMAIL'),
                                string(credentialsId: 'client_id', variable: 'CLIENT_ID'),
                                string(credentialsId: 'auth_uri', variable: 'AUTH_URI'),
                                string(credentialsId: 'token_uri', variable: 'TOKEN_URI'),
                                string(credentialsId: 'auth_provider_cert_url', variable: 'AUTH_PROVIDER_CERT_URL'),
                                string(credentialsId: 'client_cert_url', variable: 'CLIENT_CERT_URL'),
                                string(credentialsId: 'universe_domain', variable: 'UNIVERSE_DOMAIN'),
                                string(credentialsId: 'bucket', variable: 'BUCKET')]) {
                    sh './jenkins/build.sh'
                }
            }
        }
        stage("create_service") {
            steps{
                sh './jenkins/create_service.sh'
            }
        }
        stage("execute_service") {
            steps{
                sh './jenkins/execute_service.sh'
            }
        }
    }
}